{"version":3,"file":"debounce.js","sources":["../src/debounce.ts"],"sourcesContent":["import { tracked } from '@glimmer/tracking';\n\nimport { resource } from 'ember-resources';\n\nclass TrackedValue<T> {\n  @tracked value: T | undefined;\n}\n\n/**\n * A utility for debouncing high-frequency updates.\n * The returned value will only be updated every `ms` and is\n * initially undefined.\n *\n * This can be useful when a user's typing is updating a tracked\n * property and you want to derive data less frequently than on\n * each keystroke.\n *\n * Note that this utility requires the `@use` decorator\n * (debounce could be implemented without the need for the `@use` decorator\n * but the current implementation is 8 lines)\n *\n * @example\n * ```js\n *  import Component from '@glimmer/component';\n *  import { tracked } from '@glimmer/tracking';\n *  import { use } from 'ember-resources';\n *  import { debounce } from 'reactiveweb/debounce';\n *\n *  const delay = 100; // ms\n *\n *  class Demo extends Component {\n *    @tracked userInput = '';\n *\n *    @use debouncedInput = debounce(delay, () => this.userInput);\n *  }\n * ```\n *\n * @example\n * This could be further composed with RemoteData\n * ```js\n *  import Component from '@glimmer/component';\n *  import { tracked } from '@glimmer/tracking';\n *  import { use } from 'ember-resources';\n *  import { debounce } from 'reactiveweb/debounce';\n *  import { RemoteData } from 'reactiveweb/remote-data';\n *\n *  const delay = 100; // ms\n *\n *  class Demo extends Component {\n *    @tracked userInput = '';\n *\n *    @use debouncedInput = debounce(delay, () => this.userInput);\n *\n *    @use search = RemoteData(() => `https://my.domain/search?q=${this.debouncedInput}`);\n *  }\n * ```\n *\n * @param {number} ms delay in milliseconds to wait before updating the returned value\n * @param {() => Value} thunk function that returns the value to debounce\n */\nexport function debounce<Value = unknown>(ms: number, thunk: () => Value) {\n  let lastValue: Value;\n  let timer: number;\n  let state = new TrackedValue<Value>();\n\n  return resource(({ on }) => {\n    lastValue = thunk();\n\n    on.cleanup(() => timer && clearTimeout(timer));\n    timer = setTimeout(() => (state.value = lastValue), ms);\n\n    return state.value;\n  });\n}\n"],"names":["TrackedValue","g","this","prototype","tracked","i","void 0","debounce","ms","thunk","lastValue","timer","state","resource","on","cleanup","clearTimeout","setTimeout","value"],"mappings":";;;;AAIA,MAAMA,YAAY,CAAI;AAAA,EAAA;AAAAC,IAAAA,CAAA,CAAAC,IAAA,CAAAC,SAAA,YACnBC,OAAO,CAAA,CAAA,CAAA;AAAA,GAAA;AAAA,EAAA,MAAA,IAAAC,CAAA,CAAAH,IAAA,YAAAI,KAAA,CAAA,EAAA;AACV,CAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAASC,QAAQA,CAAkBC,EAAU,EAAEC,KAAkB,EAAE;AACxE,EAAA,IAAIC,SAAgB,CAAA;AACpB,EAAA,IAAIC,KAAa,CAAA;AACjB,EAAA,IAAIC,KAAK,GAAG,IAAIZ,YAAY,EAAS,CAAA;EAErC,OAAOa,QAAQ,CAAC,CAAC;AAAEC,IAAAA,EAAAA;AAAG,GAAC,KAAK;IAC1BJ,SAAS,GAAGD,KAAK,EAAE,CAAA;IAEnBK,EAAE,CAACC,OAAO,CAAC,MAAMJ,KAAK,IAAIK,YAAY,CAACL,KAAK,CAAC,CAAC,CAAA;IAC9CA,KAAK,GAAGM,UAAU,CAAC,MAAOL,KAAK,CAACM,KAAK,GAAGR,SAAU,EAAEF,EAAE,CAAC,CAAA;IAEvD,OAAOI,KAAK,CAACM,KAAK,CAAA;AACpB,GAAC,CAAC,CAAA;AACJ;;;;"}